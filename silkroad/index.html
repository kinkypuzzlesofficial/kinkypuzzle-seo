<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>phBot Live Stats Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f4f4f4; padding: 20px; }
    h1 { color: #007bff; text-align: center; }
    .char-card { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 2px 2px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <div class="container">
    <h1>phBot Live Stats</h1>
    <div class="row mb-3">
      <div class="col-md-6 offset-md-3">
        <select id="charSelector" class="form-select" onchange="showStats()">
          <option>Loading...</option>
        </select>
      </div>
    </div>
    <div id="stats" class="char-card">Waiting for data...</div>
  </div>

  <script>
    let dataCache = {};

    async function fetchStats() {
      try {
        const res = await fetch('https://botstats-worker.kinkypuzzlesofficial.workers.dev/');
        dataCache = await res.json();
        const selector = document.getElementById('charSelector');
        selector.innerHTML = '';
        for (const charName in dataCache) {
          selector.innerHTML += `<option value="${charName}">${charName}</option>`;
        }
        showStats();
      } catch (error) {
        console.error('Fetch failed', error);
        document.getElementById('stats').innerHTML = '<p class="text-danger">Failed to fetch stats.</p>';
      }
    }

    function showStats() {
      const charName = document.getElementById('charSelector').value;
      const stats = dataCache[charName];
      if (!stats) return;
      document.getElementById('stats').innerHTML = `
        <h3>${charName}</h3>
        <p><strong>Status:</strong> ${stats.dead ? '<span class="text-danger">Dead</span>' : '<span class="text-success">Alive</span>'}, Botting: ${stats.botting}, Connected: ${stats.connected}</p>
        <p><strong>Location:</strong> ${stats.zone_name} (${stats.x.toFixed(2)}, ${stats.y.toFixed(2)})</p>
        <p><strong>Level:</strong> ${stats.level}, Guild: ${stats.guild}, Server: ${stats.server}</p>
        <p><strong>EXP:</strong> ${stats.exp.toLocaleString()} (Per Hour: ${stats.exp_hour.toFixed(2)}), Time to Level: ${stats.time_to_level.toFixed(2)} hours</p>
        <p><strong>SP:</strong> ${stats.sp.toLocaleString()} (Per Hour: ${stats.sp_hour.toFixed(2)}), SP Gained: ${stats.sp_gained}</p>
        <p><strong>Gold:</strong> ${stats.gold.toLocaleString()}, Drops: ${stats.drops}</p>
        <p><strong>HP:</strong> ${stats.hp}/${stats.hp_max}, MP: ${stats.mp}/${stats.mp_max}</p>
        <p><strong>Kills:</strong> ${stats.kill_count}, Deaths: ${stats.death_count}</p>
      `;
    }

    setInterval(fetchStats, 5000);
    fetchStats();
  </script>
</body>
</html>
